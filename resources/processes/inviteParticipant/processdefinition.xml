<?xml version="1.0" encoding="UTF-8"?>

<process-definition
  xmlns=""  name="participantInvitation">
   <start-state name="start">
      <transition name="toCreateBpmUser" to="createBpmUser"></transition>
   </start-state>
   <node name="sendInvitation">
      <event type="node-enter">
         <action name="sendInvitationAction" class="com.idega.bpm.process.invitation.SendParticipantInvitationMessageHandler">
				<messageExp>
					#{participantInvitationMessage}
				</messageExp>
				<userDataExp>
					#{participantUserData}
				</userDataExp>
				<processInstanceIdExp>
					#{sendFromProcessInstanceId}
				</processInstanceIdExp>
				<bpmUserIdExp>
                    #{bpmUserId}
                </bpmUserIdExp>
	            <inlineSubject key-type='java.lang.String' value-type='java.lang.String'>
	                <entry><key>en</key><value>You've been invited to participate in case</value></entry>
	                <entry><key>is_IS</key><value>\u00DE\u00E9r hefur veri\u00F0 bo\u00F0i\u00F0 a\u00F0 taka \u00FE\u00E1tt e\u00F0a gefa \u00E1lit \u00E1 m\u00E1li</value></entry>
	            </inlineSubject>
	            <inlineMessage key-type='java.lang.String' value-type='java.lang.String'>
	                <entry><key>en</key><value>Hello. \n\nYou have been invited to the case, you may follow the link to the case: {0}</value></entry>
	                <entry><key>is_IS</key><value>Opna\u00F0u eftirfarandi sl\u00F3\u00F0 til a\u00F0 sko\u00F0a m\u00E1li\u00F0 sem a\u00F0 um r\u00E6\u00F0ir\: {0}</value></entry>
	            </inlineMessage>
	            <messageValues>{list: {mv: [{type: "bean", value: "bpmUser.urlToTheProcess"}]}}</messageValues>
			</action>
      </event>
      <transition name="toEnd" to="end1"></transition>
   </node>

	<node name="createBpmUser">
		<event type="node-enter">
			<action name="createBpmUserAction" class="com.idega.jbpm.identity.CreateBPMUserHandler">
				<processInstanceIdExp>
					#{sendFromProcessInstanceId}
				</processInstanceIdExp>
				<userDataExp>
					#{participantUserData}
				</userDataExp>
				<roleExpressionExp>
					#{participantRoleExpression}
				</roleExpressionExp>
				<bpmUserIdVariableNameExp>
                    bpmUserId
                </bpmUserIdVariableNameExp>
				
			</action>
		</event>
		<transition to="sendInvitation" name="toSendInvitation"></transition>
	</node>

	<node name="assignRoleToBpmUser">
		<event type="node-enter">
			<action class="com.idega.jbpm.identity.authentication.AssignUserToRoleHandler" name="assingRoleToBpmUserAction">
				<processInstanceIdExp>
					#{sendFromProcessInstanceId}
				</processInstanceIdExp>
				<roleExpressionExp>
					#{participantRoleExpression}
				</roleExpressionExp>
				<userIdExp>
					#{bpmUserId}
				</userIdExp>
			</action>
		</event>
	</node>
   <end-state name="end1">
      <event type="node-enter">
         <action name="endProcessAction" class="com.idega.jbpm.process.business.EndProcessHandler" config-type="constructor"></action>
      </event>
   </end-state>
</process-definition>